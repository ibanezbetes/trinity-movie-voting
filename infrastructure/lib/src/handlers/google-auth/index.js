"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_cognito_identity_provider_1 = require("@aws-sdk/client-cognito-identity-provider");
const cognitoClient = new client_cognito_identity_provider_1.CognitoIdentityProviderClient({ region: process.env.AWS_REGION });
const USER_POOL_ID = process.env.USER_POOL_ID;
const USER_POOL_CLIENT_ID = process.env.USER_POOL_CLIENT_ID;
const handler = async (event) => {
    console.log('Google Auth Handler - Event:', JSON.stringify(event, null, 2));
    const { googleIdToken } = event.arguments || {};
    if (!googleIdToken) {
        throw new Error('Google ID token is required');
    }
    try {
        // Decode the Google ID token (without verification for now - in production, verify it!)
        const tokenParts = googleIdToken.split('.');
        if (tokenParts.length !== 3) {
            throw new Error('Invalid Google ID token format');
        }
        const payload = JSON.parse(Buffer.from(tokenParts[1], 'base64').toString('utf-8'));
        console.log('Decoded Google token:', { email: payload.email, sub: payload.sub });
        const email = payload.email;
        const googleSub = payload.sub;
        if (!email) {
            throw new Error('Email not found in Google token');
        }
        // Check if user exists in User Pool
        let userExists = false;
        try {
            await cognitoClient.send(new client_cognito_identity_provider_1.AdminGetUserCommand({
                UserPoolId: USER_POOL_ID,
                Username: email,
            }));
            userExists = true;
            console.log('User already exists:', email);
        }
        catch (error) {
            if (error.name !== 'UserNotFoundException') {
                throw error;
            }
            console.log('User does not exist, will create:', email);
        }
        // Create user if doesn't exist
        if (!userExists) {
            console.log('Creating new user in User Pool');
            await cognitoClient.send(new client_cognito_identity_provider_1.AdminCreateUserCommand({
                UserPoolId: USER_POOL_ID,
                Username: email,
                UserAttributes: [
                    { Name: 'email', Value: email },
                    { Name: 'email_verified', Value: 'true' },
                    { Name: 'name', Value: payload.name || payload.given_name || email },
                    { Name: 'preferred_username', Value: payload.given_name || email.split('@')[0] },
                ],
                MessageAction: 'SUPPRESS', // Don't send welcome email
            }));
            // Set a random password (user won't use it, they'll use Google)
            const randomPassword = `Temp${Math.random().toString(36).slice(-8)}!1A`;
            await cognitoClient.send(new client_cognito_identity_provider_1.AdminSetUserPasswordCommand({
                UserPoolId: USER_POOL_ID,
                Username: email,
                Password: randomPassword,
                Permanent: true,
            }));
            console.log('User created successfully');
        }
        // Now initiate auth to get tokens
        // We'll use ADMIN_NO_SRP_AUTH flow
        const authResponse = await cognitoClient.send(new client_cognito_identity_provider_1.AdminInitiateAuthCommand({
            UserPoolId: USER_POOL_ID,
            ClientId: USER_POOL_CLIENT_ID,
            AuthFlow: 'CUSTOM_AUTH',
            AuthParameters: {
                USERNAME: email,
            },
        }));
        console.log('Auth response:', {
            hasAccessToken: !!authResponse.AuthenticationResult?.AccessToken,
            hasIdToken: !!authResponse.AuthenticationResult?.IdToken,
            hasRefreshToken: !!authResponse.AuthenticationResult?.RefreshToken,
        });
        return {
            success: true,
            accessToken: authResponse.AuthenticationResult?.AccessToken,
            idToken: authResponse.AuthenticationResult?.IdToken,
            refreshToken: authResponse.AuthenticationResult?.RefreshToken,
            email: email,
        };
    }
    catch (error) {
        console.error('Error in Google auth handler:', error);
        throw error;
    }
};
exports.handler = handler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvaGFuZGxlcnMvZ29vZ2xlLWF1dGgvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZ0dBQThMO0FBRTlMLE1BQU0sYUFBYSxHQUFHLElBQUksZ0VBQTZCLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0FBQzVGLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBYSxDQUFDO0FBQy9DLE1BQU0sbUJBQW1CLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBb0IsQ0FBQztBQVd0RCxNQUFNLE9BQU8sR0FBRyxLQUFLLEVBQUUsS0FBVSxFQUFFLEVBQUU7SUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUU1RSxNQUFNLEVBQUUsYUFBYSxFQUFFLEdBQUcsS0FBSyxDQUFDLFNBQVMsSUFBSSxFQUFFLENBQUM7SUFFaEQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ25CLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBRUQsSUFBSSxDQUFDO1FBQ0gsd0ZBQXdGO1FBQ3hGLE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsSUFBSSxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzVCLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsTUFBTSxPQUFPLEdBQXVCLElBQUksQ0FBQyxLQUFLLENBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxF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RSxhQUFhO1lBQ3ZCLGNBQWMsRUFBRTtnQkFDZCxRQUFRLEVBQUUsS0FBSzthQUNoQjtTQUNGLENBQUMsQ0FBQyxDQUFDO1FBRUosT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRTtZQUM1QixjQUFjLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxXQUFXO1lBQ2hFLFVBQVUsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLG9CQUFvQixFQUFFLE9BQU87WUFDeEQsZUFBZSxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsb0JBQW9CLEVBQUUsWUFBWTtTQUNuRSxDQUFDLENBQUM7UUFFSCxPQUFPO1lBQ0wsT0FBTyxFQUFFLElBQUk7WUFDYixXQUFXLEVBQUUsWUFBWSxDQUFDLG9CQUFvQixFQUFFLFdBQVc7WUFDM0QsT0FBTyxFQUFFLFlBQVksQ0FBQyxvQkFBb0IsRUFBRSxPQUFPO1lBQ25ELFlBQVksRUFBRSxZQUFZLENBQUMsb0JBQW9CLEVBQUUsWUFBWTtZQUM3RCxLQUFLLEVBQUUsS0FBSztTQUNiLENBQUM7SUFFSixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsK0JBQStCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdEQsTUFBTSxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBdEdXLFFBQUEsT0FBTyxXQXNHbEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2duaXRvSWRlbnRpdHlQcm92aWRlckNsaWVudCwgQWRtaW5DcmVhdGVVc2VyQ29tbWFuZCwgQWRtaW5TZXRVc2VyUGFzc3dvcmRDb21tYW5kLCBBZG1pbkluaXRpYXRlQXV0aENvbW1hbmQsIEFkbWluR2V0VXNlckNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtY29nbml0by1pZGVudGl0eS1wcm92aWRlcic7XHJcblxyXG5jb25zdCBjb2duaXRvQ2xpZW50ID0gbmV3IENvZ25pdG9JZGVudGl0eVByb3ZpZGVyQ2xpZW50KHsgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIH0pO1xyXG5jb25zdCBVU0VSX1BPT0xfSUQgPSBwcm9jZXNzLmVudi5VU0VSX1BPT0xfSUQhO1xyXG5jb25zdCBVU0VSX1BPT0xfQ0xJRU5UX0lEID0gcHJvY2Vzcy5lbnYuVVNFUl9QT09MX0NMSUVOVF9JRCE7XHJcblxyXG5pbnRlcmZhY2UgR29vZ2xlVG9rZW5QYXlsb2FkIHtcclxuICBlbWFpbDogc3RyaW5nO1xyXG4gIG5hbWU/OiBzdHJpbmc7XHJcbiAgZ2l2ZW5fbmFtZT86IHN0cmluZztcclxuICBmYW1pbHlfbmFtZT86IHN0cmluZztcclxuICBwaWN0dXJlPzogc3RyaW5nO1xyXG4gIHN1Yjogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55KSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ0dvb2dsZSBBdXRoIEhhbmRsZXIgLSBFdmVudDonLCBKU09OLnN0cmluZ2lmeShldmVudCwgbnVsbCwgMikpO1xyXG5cclxuICBjb25zdCB7IGdvb2dsZUlkVG9rZW4gfSA9IGV2ZW50LmFyZ3VtZW50cyB8fCB7fTtcclxuXHJcbiAgaWYgKCFnb29nbGVJZFRva2VuKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0dvb2dsZSBJRCB0b2tlbiBpcyByZXF1aXJlZCcpO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIERlY29kZSB0aGUgR29vZ2xlIElEIHRva2VuICh3aXRob3V0IHZlcmlmaWNhdGlvbiBmb3Igbm93IC0gaW4gcHJvZHVjdGlvbiwgdmVyaWZ5IGl0ISlcclxuICAgIGNvbnN0IHRva2VuUGFydHMgPSBnb29nbGVJZFRva2VuLnNwbGl0KCcuJyk7XHJcbiAgICBpZiAodG9rZW5QYXJ0cy5sZW5ndGggIT09IDMpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIEdvb2dsZSBJRCB0b2tlbiBmb3JtYXQnKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwYXlsb2FkOiBHb29nbGVUb2tlblBheWxvYWQgPSBKU09OLnBhcnNlKFxyXG4gICAgICBCdWZmZXIuZnJvbSh0b2tlblBhcnRzWzFdLCAnYmFzZTY0JykudG9TdHJpbmcoJ3V0Zi04JylcclxuICAgICk7XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0RlY29kZWQgR29vZ2xlIHRva2VuOicsIHsgZW1haWw6IHBheWxvYWQuZW1haWwsIHN1YjogcGF5bG9hZC5zdWIgfSk7XHJcblxyXG4gICAgY29uc3QgZW1haWwgPSBwYXlsb2FkLmVtYWlsO1xyXG4gICAgY29uc3QgZ29vZ2xlU3ViID0gcGF5bG9hZC5zdWI7XHJcblxyXG4gICAgaWYgKCFlbWFpbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VtYWlsIG5vdCBmb3VuZCBpbiBHb29nbGUgdG9rZW4nKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0cyBpbiBVc2VyIFBvb2xcclxuICAgIGxldCB1c2VyRXhpc3RzID0gZmFsc2U7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBjb2duaXRvQ2xpZW50LnNlbmQobmV3IEFkbWluR2V0VXNlckNvbW1hbmQoe1xyXG4gICAgICAgIFVzZXJQb29sSWQ6IFVTRVJfUE9PTF9JRCxcclxuICAgICAgICBVc2VybmFtZTogZW1haWwsXHJcbiAgICAgIH0pKTtcclxuICAgICAgdXNlckV4aXN0cyA9IHRydWU7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIGFscmVhZHkgZXhpc3RzOicsIGVtYWlsKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgaWYgKGVycm9yLm5hbWUgIT09ICdVc2VyTm90Rm91bmRFeGNlcHRpb24nKSB7XHJcbiAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5sb2coJ1VzZXIgZG9lcyBub3QgZXhpc3QsIHdpbGwgY3JlYXRlOicsIGVtYWlsKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDcmVhdGUgdXNlciBpZiBkb2Vzbid0IGV4aXN0XHJcbiAgICBpZiAoIXVzZXJFeGlzdHMpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIG5ldyB1c2VyIGluIFVzZXIgUG9vbCcpO1xyXG4gICAgICBcclxuICAgICAgYXdhaXQgY29nbml0b0NsaWVudC5zZW5kKG5ldyBBZG1pbkNyZWF0ZVVzZXJDb21tYW5kKHtcclxuICAgICAgICBVc2VyUG9vbElkOiBVU0VSX1BPT0xfSUQsXHJcbiAgICAgICAgVXNlcm5hbWU6IGVtYWlsLFxyXG4gICAgICAgIFVzZXJBdHRyaWJ1dGVzOiBbXHJcbiAgICAgICAgICB7IE5hbWU6ICdlbWFpbCcsIFZhbHVlOiBlbWFpbCB9LFxyXG4gICAgICAgICAgeyBOYW1lOiAnZW1haWxfdmVyaWZpZWQnLCBWYWx1ZTogJ3RydWUnIH0sXHJcbiAgICAgICAgICB7IE5hbWU6ICduYW1lJywgVmFsdWU6IHBheWxvYWQubmFtZSB8fCBwYXlsb2FkLmdpdmVuX25hbWUgfHwgZW1haWwgfSxcclxuICAgICAgICAgIHsgTmFtZTogJ3ByZWZlcnJlZF91c2VybmFtZScsIFZhbHVlOiBwYXlsb2FkLmdpdmVuX25hbWUgfHwgZW1haWwuc3BsaXQoJ0AnKVswXSB9LFxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgTWVzc2FnZUFjdGlvbjogJ1NVUFBSRVNTJywgLy8gRG9uJ3Qgc2VuZCB3ZWxjb21lIGVtYWlsXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIC8vIFNldCBhIHJhbmRvbSBwYXNzd29yZCAodXNlciB3b24ndCB1c2UgaXQsIHRoZXknbGwgdXNlIEdvb2dsZSlcclxuICAgICAgY29uc3QgcmFuZG9tUGFzc3dvcmQgPSBgVGVtcCR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoLTgpfSExQWA7XHJcbiAgICAgIGF3YWl0IGNvZ25pdG9DbGllbnQuc2VuZChuZXcgQWRtaW5TZXRVc2VyUGFzc3dvcmRDb21tYW5kKHtcclxuICAgICAgICBVc2VyUG9vbElkOiBVU0VSX1BPT0xfSUQsXHJcbiAgICAgICAgVXNlcm5hbWU6IGVtYWlsLFxyXG4gICAgICAgIFBhc3N3b3JkOiByYW5kb21QYXNzd29yZCxcclxuICAgICAgICBQZXJtYW5lbnQ6IHRydWUsXHJcbiAgICAgIH0pKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTm93IGluaXRpYXRlIGF1dGggdG8gZ2V0IHRva2Vuc1xyXG4gICAgLy8gV2UnbGwgdXNlIEFETUlOX05PX1NSUF9BVVRIIGZsb3dcclxuICAgIGNvbnN0IGF1dGhSZXNwb25zZSA9IGF3YWl0IGNvZ25pdG9DbGllbnQuc2VuZChuZXcgQWRtaW5Jbml0aWF0ZUF1dGhDb21tYW5kKHtcclxuICAgICAgVXNlclBvb2xJZDogVVNFUl9QT09MX0lELFxyXG4gICAgICBDbGllbnRJZDogVVNFUl9QT09MX0NMSUVOVF9JRCxcclxuICAgICAgQXV0aEZsb3c6ICdDVVNUT01fQVVUSCcsXHJcbiAgICAgIEF1dGhQYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgVVNFUk5BTUU6IGVtYWlsLFxyXG4gICAgICB9LFxyXG4gICAgfSkpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdBdXRoIHJlc3BvbnNlOicsIHsgXHJcbiAgICAgIGhhc0FjY2Vzc1Rva2VuOiAhIWF1dGhSZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdD8uQWNjZXNzVG9rZW4sXHJcbiAgICAgIGhhc0lkVG9rZW46ICEhYXV0aFJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0Py5JZFRva2VuLFxyXG4gICAgICBoYXNSZWZyZXNoVG9rZW46ICEhYXV0aFJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0Py5SZWZyZXNoVG9rZW4sXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBhY2Nlc3NUb2tlbjogYXV0aFJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0Py5BY2Nlc3NUb2tlbixcclxuICAgICAgaWRUb2tlbjogYXV0aFJlc3BvbnNlLkF1dGhlbnRpY2F0aW9uUmVzdWx0Py5JZFRva2VuLFxyXG4gICAgICByZWZyZXNoVG9rZW46IGF1dGhSZXNwb25zZS5BdXRoZW50aWNhdGlvblJlc3VsdD8uUmVmcmVzaFRva2VuLFxyXG4gICAgICBlbWFpbDogZW1haWwsXHJcbiAgICB9O1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gR29vZ2xlIGF1dGggaGFuZGxlcjonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcbiJdfQ==