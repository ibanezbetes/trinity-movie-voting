"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
const client = new client_dynamodb_1.DynamoDBClient({});
const docClient = lib_dynamodb_1.DynamoDBDocumentClient.from(client);
const RECOMMENDATIONS_TABLE = process.env.RECOMMENDATIONS_TABLE || 'trinity-recommendations';
const handler = async (event) => {
    console.log('Recommendations Handler - Event:', JSON.stringify(event, null, 2));
    const fieldName = event.info.fieldName;
    try {
        switch (fieldName) {
            case 'getRecommendations':
                return await getRecommendations();
            case 'getRecommendationsByCategory':
                return await getRecommendationsByCategory(event.arguments.categoryId);
            default:
                throw new Error(`Unknown field: ${fieldName}`);
        }
    }
    catch (error) {
        console.error('Error in recommendations handler:', error);
        throw error;
    }
};
exports.handler = handler;
async function getRecommendations() {
    console.log('Getting all recommendations');
    // Scan all items from recommendations table
    const result = await docClient.send(new lib_dynamodb_1.ScanCommand({
        TableName: RECOMMENDATIONS_TABLE,
    }));
    if (!result.Items || result.Items.length === 0) {
        console.log('No recommendations found');
        return [];
    }
    // Group movies by category
    const categoriesMap = new Map();
    for (const item of result.Items) {
        const categoryId = item.categoryId;
        if (!categoriesMap.has(categoryId)) {
            categoriesMap.set(categoryId, {
                categoryId: item.categoryId,
                title: item.categoryTitle,
                description: item.categoryDescription,
                movies: [],
            });
        }
        const category = categoriesMap.get(categoryId);
        category.movies.push({
            movieId: item.movieId,
            title: item.title,
            posterPath: item.posterPath,
            alternativePosterUrl: item.alternativePosterUrl,
            year: item.year,
            description: item.description,
            trailerKey: item.trailerKey,
        });
    }
    // Convert map to array and sort movies by movieId
    const categories = Array.from(categoriesMap.values());
    categories.forEach(category => {
        category.movies.sort((a, b) => a.movieId - b.movieId);
    });
    console.log(`Returning ${categories.length} categories`);
    return categories;
}
async function getRecommendationsByCategory(categoryId) {
    console.log('Getting recommendations for category:', categoryId);
    const result = await docClient.send(new lib_dynamodb_1.QueryCommand({
        TableName: RECOMMENDATIONS_TABLE,
        KeyConditionExpression: 'categoryId = :categoryId',
        ExpressionAttributeValues: {
            ':categoryId': categoryId,
        },
    }));
    if (!result.Items || result.Items.length === 0) {
        console.log('No recommendations found for category:', categoryId);
        return null;
    }
    const firstItem = result.Items[0];
    const category = {
        categoryId: firstItem.categoryId,
        title: firstItem.categoryTitle,
        description: firstItem.categoryDescription,
        movies: result.Items.map(item => ({
            movieId: item.movieId,
            title: item.title,
            posterPath: item.posterPath,
            alternativePosterUrl: item.alternativePosterUrl,
            year: item.year,
            description: item.description,
            trailerKey: item.trailerKey,
        })),
    };
    // Sort movies by movieId
    category.movies.sort((a, b) => a.movieId - b.movieId);
    console.log(`Returning category with ${category.movies.length} movies`);
    return category;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvaGFuZGxlcnMvcmVjb21tZW5kYXRpb25zL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDhEQUEwRDtBQUMxRCx3REFBMEY7QUFFMUYsTUFBTSxNQUFNLEdBQUcsSUFBSSxnQ0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3RDLE1BQU0sU0FBUyxHQUFHLHFDQUFzQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUV0RCxNQUFNLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUkseUJBQXlCLENBQUM7QUFtQnRGLE1BQU0sT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFVLEVBQUUsRUFBRTtJQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRWhGLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBRXZDLElBQUksQ0FBQztRQUNILFFBQVEsU0FBUyxFQUFFLENBQUM7WUFDbEIsS0FBSyxvQkFBb0I7Z0JBQ3ZCLE9BQU8sTUFBTSxrQkFBa0IsRUFBRSxDQUFDO1lBRXBDLEtBQUssOEJBQThCO2dCQUNqQyxPQUFPLE1BQU0sNEJBQTRCLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUV4RTtnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLGtCQUFrQixTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUM7SUFDSCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDMUQsTUFBTSxLQUFLLENBQUM7SUFDZCxDQUFDO0FB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QUFDLEdBQUcsQ0FBQyx3Q0FBd0MsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUNsRSxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sUUFBUSxHQUEyQjtRQUN2QyxVQUFVLEVBQUUsU0FBUyxDQUFDLFVBQVU7UUFDaEMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxhQUFhO1FBQzlCLFdBQVcsRUFBRSxTQUFTLENBQUMsbUJBQW1CO1FBQzFDLE1BQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDaEMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1lBQ3JCLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSztZQUNqQixVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7WUFDM0Isb0JBQW9CLEVBQUUsSUFBSSxDQUFDLG9CQUFvQjtZQUMvQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDN0IsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1NBQzVCLENBQUMsQ0FBQztLQUNKLENBQUM7SUFFRix5QkFBeUI7SUFDekIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUV0RCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sU0FBUyxDQUFDLENBQUM7SUFDeEUsT0FBTyxRQUFRLENBQUM7QUFDbEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IER5bmFtb0RCQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJztcclxuaW1wb3J0IHsgRHluYW1vREJEb2N1bWVudENsaWVudCwgUXVlcnlDb21tYW5kLCBTY2FuQ29tbWFuZCB9IGZyb20gJ0Bhd3Mtc2RrL2xpYi1keW5hbW9kYic7XHJcblxyXG5jb25zdCBjbGllbnQgPSBuZXcgRHluYW1vREJDbGllbnQoe30pO1xyXG5jb25zdCBkb2NDbGllbnQgPSBEeW5hbW9EQkRvY3VtZW50Q2xpZW50LmZyb20oY2xpZW50KTtcclxuXHJcbmNvbnN0IFJFQ09NTUVOREFUSU9OU19UQUJMRSA9IHByb2Nlc3MuZW52LlJFQ09NTUVOREFUSU9OU19UQUJMRSB8fCAndHJpbml0eS1yZWNvbW1lbmRhdGlvbnMnO1xyXG5cclxuaW50ZXJmYWNlIFJlY29tbWVuZGF0aW9uTW92aWUge1xyXG4gIG1vdmllSWQ6IG51bWJlcjtcclxuICB0aXRsZTogc3RyaW5nO1xyXG4gIHBvc3RlclBhdGg6IHN0cmluZztcclxuICBhbHRlcm5hdGl2ZVBvc3RlclVybD86IHN0cmluZztcclxuICB5ZWFyOiBzdHJpbmc7XHJcbiAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICB0cmFpbGVyS2V5Pzogc3RyaW5nO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUmVjb21tZW5kYXRpb25DYXRlZ29yeSB7XHJcbiAgY2F0ZWdvcnlJZDogc3RyaW5nO1xyXG4gIHRpdGxlOiBzdHJpbmc7XHJcbiAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICBtb3ZpZXM6IFJlY29tbWVuZGF0aW9uTW92aWVbXTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IGFueSkgPT4ge1xyXG4gIGNvbnNvbGUubG9nKCdSZWNvbW1lbmRhdGlvbnMgSGFuZGxlciAtIEV2ZW50OicsIEpTT04uc3RyaW5naWZ5KGV2ZW50LCBudWxsLCAyKSk7XHJcblxyXG4gIGNvbnN0IGZpZWxkTmFtZSA9IGV2ZW50LmluZm8uZmllbGROYW1lO1xyXG5cclxuICB0cnkge1xyXG4gICAgc3dpdGNoIChmaWVsZE5hbWUpIHtcclxuICAgICAgY2FzZSAnZ2V0UmVjb21tZW5kYXRpb25zJzpcclxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0UmVjb21tZW5kYXRpb25zKCk7XHJcbiAgICAgIFxyXG4gICAgICBjYXNlICdnZXRSZWNvbW1lbmRhdGlvbnNCeUNhdGVnb3J5JzpcclxuICAgICAgICByZXR1cm4gYXdhaXQgZ2V0UmVjb21tZW5kYXRpb25zQnlDYXRlZ29yeShldmVudC5hcmd1bWVudHMuY2F0ZWdvcnlJZCk7XHJcbiAgICAgIFxyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBmaWVsZDogJHtmaWVsZE5hbWV9YCk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHJlY29tbWVuZGF0aW9ucyBoYW5kbGVyOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldFJlY29tbWVuZGF0aW9ucygpOiBQcm9taXNlPFJlY29tbWVuZGF0aW9uQ2F0ZWdvcnlbXT4ge1xyXG4gIGNvbnNvbGUubG9nKCdHZXR0aW5nIGFsbCByZWNvbW1lbmRhdGlvbnMnKTtcclxuXHJcbiAgLy8gU2NhbiBhbGwgaXRlbXMgZnJvbSByZWNvbW1lbmRhdGlvbnMgdGFibGVcclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb2NDbGllbnQuc2VuZChcclxuICAgIG5ldyBTY2FuQ29tbWFuZCh7XHJcbiAgICAgIFRhYmxlTmFtZTogUkVDT01NRU5EQVRJT05TX1RBQkxFLFxyXG4gICAgfSlcclxuICApO1xyXG5cclxuICBpZiAoIXJlc3VsdC5JdGVtcyB8fCByZXN1bHQuSXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICBjb25zb2xlLmxvZygnTm8gcmVjb21tZW5kYXRpb25zIGZvdW5kJyk7XHJcbiAgICByZXR1cm4gW107XHJcbiAgfVxyXG5cclxuICAvLyBHcm91cCBtb3ZpZXMgYnkgY2F0ZWdvcnlcclxuICBjb25zdCBjYXRlZ29yaWVzTWFwID0gbmV3IE1hcDxzdHJpbmcsIFJlY29tbWVuZGF0aW9uQ2F0ZWdvcnk+KCk7XHJcblxyXG4gIGZvciAoY29uc3QgaXRlbSBvZiByZXN1bHQuSXRlbXMpIHtcclxuICAgIGNvbnN0IGNhdGVnb3J5SWQgPSBpdGVtLmNhdGVnb3J5SWQ7XHJcbiAgICBcclxuICAgIGlmICghY2F0ZWdvcmllc01hcC5oYXMoY2F0ZWdvcnlJZCkpIHtcclxuICAgICAgY2F0ZWdvcmllc01hcC5zZXQoY2F0ZWdvcnlJZCwge1xyXG4gICAgICAgIGNhdGVnb3J5SWQ6IGl0ZW0uY2F0ZWdvcnlJZCxcclxuICAgICAgICB0aXRsZTogaXRlbS5jYXRlZ29yeVRpdGxlLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBpdGVtLmNhdGVnb3J5RGVzY3JpcHRpb24sXHJcbiAgICAgICAgbW92aWVzOiBbXSxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2F0ZWdvcnkgPSBjYXRlZ29yaWVzTWFwLmdldChjYXRlZ29yeUlkKSE7XHJcbiAgICBjYXRlZ29yeS5tb3ZpZXMucHVzaCh7XHJcbiAgICAgIG1vdmllSWQ6IGl0ZW0ubW92aWVJZCxcclxuICAgICAgdGl0bGU6IGl0ZW0udGl0bGUsXHJcbiAgICAgIHBvc3RlclBhdGg6IGl0ZW0ucG9zdGVyUGF0aCxcclxuICAgICAgYWx0ZXJuYXRpdmVQb3N0ZXJVcmw6IGl0ZW0uYWx0ZXJuYXRpdmVQb3N0ZXJVcmwsXHJcbiAgICAgIHllYXI6IGl0ZW0ueWVhcixcclxuICAgICAgZGVzY3JpcHRpb246IGl0ZW0uZGVzY3JpcHRpb24sXHJcbiAgICAgIHRyYWlsZXJLZXk6IGl0ZW0udHJhaWxlcktleSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29udmVydCBtYXAgdG8gYXJyYXkgYW5kIHNvcnQgbW92aWVzIGJ5IG1vdmllSWRcclxuICBjb25zdCBjYXRlZ29yaWVzID0gQXJyYXkuZnJvbShjYXRlZ29yaWVzTWFwLnZhbHVlcygpKTtcclxuICBjYXRlZ29yaWVzLmZvckVhY2goY2F0ZWdvcnkgPT4ge1xyXG4gICAgY2F0ZWdvcnkubW92aWVzLnNvcnQoKGEsIGIpID0+IGEubW92aWVJZCAtIGIubW92aWVJZCk7XHJcbiAgfSk7XHJcblxyXG4gIGNvbnNvbGUubG9nKGBSZXR1cm5pbmcgJHtjYXRlZ29yaWVzLmxlbmd0aH0gY2F0ZWdvcmllc2ApO1xyXG4gIHJldHVybiBjYXRlZ29yaWVzO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBnZXRSZWNvbW1lbmRhdGlvbnNCeUNhdGVnb3J5KGNhdGVnb3J5SWQ6IHN0cmluZyk6IFByb21pc2U8UmVjb21tZW5kYXRpb25DYXRlZ29yeSB8IG51bGw+IHtcclxuICBjb25zb2xlLmxvZygnR2V0dGluZyByZWNvbW1lbmRhdGlvbnMgZm9yIGNhdGVnb3J5OicsIGNhdGVnb3J5SWQpO1xyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBkb2NDbGllbnQuc2VuZChcclxuICAgIG5ldyBRdWVyeUNvbW1hbmQoe1xyXG4gICAgICBUYWJsZU5hbWU6IFJFQ09NTUVOREFUSU9OU19UQUJMRSxcclxuICAgICAgS2V5Q29uZGl0aW9uRXhwcmVzc2lvbjogJ2NhdGVnb3J5SWQgPSA6Y2F0ZWdvcnlJZCcsXHJcbiAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHtcclxuICAgICAgICAnOmNhdGVnb3J5SWQnOiBjYXRlZ29yeUlkLFxyXG4gICAgICB9LFxyXG4gICAgfSlcclxuICApO1xyXG5cclxuICBpZiAoIXJlc3VsdC5JdGVtcyB8fCByZXN1bHQuSXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICBjb25zb2xlLmxvZygnTm8gcmVjb21tZW5kYXRpb25zIGZvdW5kIGZvciBjYXRlZ29yeTonLCBjYXRlZ29yeUlkKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZmlyc3RJdGVtID0gcmVzdWx0Lkl0ZW1zWzBdO1xyXG4gIGNvbnN0IGNhdGVnb3J5OiBSZWNvbW1lbmRhdGlvbkNhdGVnb3J5ID0ge1xyXG4gICAgY2F0ZWdvcnlJZDogZmlyc3RJdGVtLmNhdGVnb3J5SWQsXHJcbiAgICB0aXRsZTogZmlyc3RJdGVtLmNhdGVnb3J5VGl0bGUsXHJcbiAgICBkZXNjcmlwdGlvbjogZmlyc3RJdGVtLmNhdGVnb3J5RGVzY3JpcHRpb24sXHJcbiAgICBtb3ZpZXM6IHJlc3VsdC5JdGVtcy5tYXAoaXRlbSA9PiAoe1xyXG4gICAgICBtb3ZpZUlkOiBpdGVtLm1vdmllSWQsXHJcbiAgICAgIHRpdGxlOiBpdGVtLnRpdGxlLFxyXG4gICAgICBwb3N0ZXJQYXRoOiBpdGVtLnBvc3RlclBhdGgsXHJcbiAgICAgIGFsdGVybmF0aXZlUG9zdGVyVXJsOiBpdGVtLmFsdGVybmF0aXZlUG9zdGVyVXJsLFxyXG4gICAgICB5ZWFyOiBpdGVtLnllYXIsXHJcbiAgICAgIGRlc2NyaXB0aW9uOiBpdGVtLmRlc2NyaXB0aW9uLFxyXG4gICAgICB0cmFpbGVyS2V5OiBpdGVtLnRyYWlsZXJLZXksXHJcbiAgICB9KSksXHJcbiAgfTtcclxuXHJcbiAgLy8gU29ydCBtb3ZpZXMgYnkgbW92aWVJZFxyXG4gIGNhdGVnb3J5Lm1vdmllcy5zb3J0KChhLCBiKSA9PiBhLm1vdmllSWQgLSBiLm1vdmllSWQpO1xyXG5cclxuICBjb25zb2xlLmxvZyhgUmV0dXJuaW5nIGNhdGVnb3J5IHdpdGggJHtjYXRlZ29yeS5tb3ZpZXMubGVuZ3RofSBtb3ZpZXNgKTtcclxuICByZXR1cm4gY2F0ZWdvcnk7XHJcbn1cclxuIl19