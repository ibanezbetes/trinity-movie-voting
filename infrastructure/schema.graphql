type Room @aws_iam @aws_cognito_user_pools {
  id: ID!
  code: String!
  hostId: String!
  mediaType: MediaType!
  genreIds: [Int!]!
  candidates: [MovieCandidate!]!
  createdAt: AWSDateTime!
  maxParticipants: Int!
}

type MovieCandidate @aws_iam @aws_cognito_user_pools {
  id: Int!
  title: String!
  overview: String!
  posterPath: String
  releaseDate: String
  mediaType: MediaType!
  trailerKey: String
}

type Match @aws_iam @aws_cognito_user_pools {
  id: ID!
  roomId: String!
  movieId: Int!
  title: String!
  posterPath: String
  timestamp: AWSDateTime!
  matchedUsers: [String!]!
}

type Vote @aws_iam @aws_cognito_user_pools {
  roomId: String!
  userId: String!
  movieId: Int!
  vote: Boolean!
}

enum MediaType {
  MOVIE
  TV
}

type Mutation {
  createRoom(input: CreateRoomInput!): Room! @aws_iam @aws_cognito_user_pools
  joinRoom(code: String!): Room! @aws_iam @aws_cognito_user_pools
  vote(input: VoteInput!): VoteResult! @aws_iam @aws_cognito_user_pools
  createMatch(input: CreateMatchInput!): Match! @aws_iam @aws_cognito_user_pools
  publishRoomMatch(roomId: ID!, matchData: RoomMatchInput!): RoomMatchEvent! @aws_iam
  publishUserMatch(userId: ID!, matchData: RoomMatchInput!): UserMatchEvent! @aws_iam
  addRoomMember(roomId: ID!, userId: String!): RoomMembership! @aws_iam @aws_cognito_user_pools
  removeRoomMember(roomId: ID!, userId: String!): Boolean! @aws_iam @aws_cognito_user_pools
  leaveRoom(roomId: ID!): Boolean! @aws_iam @aws_cognito_user_pools
  deleteUserAccount: DeleteUserResult! @aws_iam @aws_cognito_user_pools
}

input CreateMatchInput {
  roomId: String!
  movieId: Int!
  title: String!
  posterPath: String
  matchedUsers: [String!]!
}

type Query {
  getRoom(id: String!): Room @aws_iam @aws_cognito_user_pools
  getMyRooms: [Room!]! @aws_iam @aws_cognito_user_pools
  getMyMatches: [Match!]! @aws_iam @aws_cognito_user_pools
  checkRoomMatch(roomId: String!): Match @aws_iam @aws_cognito_user_pools
  checkUserMatches: [Match!]! @aws_iam @aws_cognito_user_pools
  getRoomMembers(roomId: ID!): [RoomMembership!]! @aws_iam @aws_cognito_user_pools
  getUserRooms(userId: String!): [RoomMembership!]! @aws_iam @aws_cognito_user_pools
  getUsernameEmail(username: String!): UsernameMapping @aws_api_key
  getRecommendations: [RecommendationCategory!]! @aws_iam @aws_cognito_user_pools
  getRecommendationsByCategory(categoryId: String!): RecommendationCategory @aws_iam @aws_cognito_user_pools
}

type Subscription {
  onMatchCreated: Match
    @aws_subscribe(mutations: ["createMatch"])
    @aws_iam
    @aws_cognito_user_pools
  roomMatch(roomId: ID!): RoomMatchEvent
    @aws_subscribe(mutations: ["publishRoomMatch"])
    @aws_iam
    @aws_cognito_user_pools
  userMatch(userId: ID!): UserMatchEvent
    @aws_subscribe(mutations: ["publishUserMatch"])
    @aws_iam
    @aws_cognito_user_pools
}

input CreateRoomInput {
  mediaType: MediaType!
  genreIds: [Int!]!
  maxParticipants: Int!
}

input VoteInput {
  roomId: String!
  movieId: Int!
  vote: Boolean!
}

type VoteResult @aws_iam @aws_cognito_user_pools {
  success: Boolean!
  match: Match
}

type RoomMatchEvent @aws_iam {
  roomId: ID!
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  timestamp: AWSDateTime!
  matchDetails: MatchDetails
}

type UserMatchEvent @aws_iam {
  userId: ID!
  roomId: ID!
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  timestamp: AWSDateTime!
  matchDetails: MatchDetails
}

type MatchDetails @aws_iam {
  voteCount: Int!
  requiredVotes: Int!
  matchType: String!
}

type RoomMembership @aws_iam @aws_cognito_user_pools {
  roomId: ID!
  userId: String!
  joinedAt: AWSDateTime!
  isActive: Boolean!
  role: String!
}

type UsernameMapping @aws_api_key {
  username: String!
  email: String!
}

type DeleteUserResult @aws_iam @aws_cognito_user_pools {
  success: Boolean!
  message: String!
  deletedItems: DeletedItems!
}

type DeletedItems @aws_iam @aws_cognito_user_pools {
  username: Boolean!
  rooms: Int!
  votes: Int!
  matches: Int!
}

type RecommendationCategory @aws_iam @aws_cognito_user_pools {
  categoryId: String!
  title: String!
  description: String!
  movies: [RecommendationMovie!]!
}

type RecommendationMovie @aws_iam @aws_cognito_user_pools {
  movieId: Int!
  title: String!
  posterPath: String!
  alternativePosterUrl: String
  year: String!
  description: String!
  trailerKey: String
}

input RoomMatchInput {
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  roomId: ID
  timestamp: AWSDateTime
  matchDetails: MatchDetailsInput
}

input MatchDetailsInput {
  voteCount: Int!
  requiredVotes: Int!
  matchType: String!
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}