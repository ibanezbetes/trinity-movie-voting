type Room {
  id: ID!
  code: String!
  hostId: String!
  mediaType: MediaType!
  genreIds: [Int!]!
  candidates: [MovieCandidate!]!
  createdAt: AWSDateTime!
  maxParticipants: Int!
}

type MovieCandidate {
  id: Int!
  title: String!
  overview: String!
  posterPath: String
  releaseDate: String
  mediaType: MediaType!
}

type Match {
  id: ID!
  roomId: String!
  movieId: Int!
  title: String!
  posterPath: String
  timestamp: AWSDateTime!
  matchedUsers: [String!]!
}

type Vote {
  roomId: String!
  userId: String!
  movieId: Int!
  vote: Boolean!
}

enum MediaType {
  MOVIE
  TV
}

type Mutation {
  createRoom(input: CreateRoomInput!): Room!
  joinRoom(code: String!): Room!
  vote(input: VoteInput!): VoteResult!
  createMatch(input: CreateMatchInput!): Match!
  publishRoomMatch(roomId: ID!, matchData: RoomMatchInput!): RoomMatchEvent! @aws_iam
  publishUserMatch(userId: ID!, matchData: RoomMatchInput!): UserMatchEvent! @aws_iam
  addRoomMember(roomId: ID!, userId: String!): RoomMembership!
  removeRoomMember(roomId: ID!, userId: String!): Boolean!
  leaveRoom(roomId: ID!): Boolean!
}

input CreateMatchInput {
  roomId: String!
  movieId: Int!
  title: String!
  posterPath: String
  matchedUsers: [String!]!
}

type Query {
  getRoom(id: String!): Room
  getMyRooms: [Room!]!
  getMyMatches: [Match!]!
  checkRoomMatch(roomId: String!): Match
  checkUserMatches: [Match!]!
  getRoomMembers(roomId: ID!): [RoomMembership!]!
  getUserRooms(userId: String!): [RoomMembership!]!
}

type Subscription {
  onMatchCreated: Match
    @aws_subscribe(mutations: ["createMatch"])
  roomMatch(roomId: ID!): RoomMatchEvent
    @aws_subscribe(mutations: ["publishRoomMatch"])
    @aws_iam
    @aws_cognito_user_pools
  userMatch(userId: ID!): UserMatchEvent
    @aws_subscribe(mutations: ["publishUserMatch"])
    @aws_iam
    @aws_cognito_user_pools
}

input CreateRoomInput {
  mediaType: MediaType!
  genreIds: [Int!]!
  maxParticipants: Int!
}

input VoteInput {
  roomId: String!
  movieId: Int!
  vote: Boolean!
}

type VoteResult {
  success: Boolean!
  match: Match
}

type RoomMatchEvent @aws_iam {
  roomId: ID!
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  timestamp: AWSDateTime!
  matchDetails: MatchDetails
}

type UserMatchEvent @aws_iam {
  userId: ID!
  roomId: ID!
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  timestamp: AWSDateTime!
  matchDetails: MatchDetails
}

type MatchDetails @aws_iam {
  voteCount: Int!
  requiredVotes: Int!
  matchType: String!
}

type RoomMembership {
  roomId: ID!
  userId: String!
  joinedAt: AWSDateTime!
  isActive: Boolean!
  role: String!
}

input RoomMatchInput {
  matchId: ID!
  movieId: ID!
  movieTitle: String!
  posterPath: String
  matchedUsers: [String!]!
  roomId: ID
  timestamp: AWSDateTime
  matchDetails: MatchDetailsInput
}

input MatchDetailsInput {
  voteCount: Int!
  requiredVotes: Int!
  matchType: String!
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}